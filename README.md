# Laravel Docker å¼€å‘ç¯å¢ƒ

åŸºäº Docker çš„ Laravel å¼€å‘ç¯å¢ƒï¼Œæ”¯æŒ PHP 8.4 + Nginx å’Œ Caddy ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼Œæä¾›å®Œæ•´çš„å¼€å‘å·¥å…·é“¾å’Œäº¤äº’å¼ç®¡ç†ç•Œé¢ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ³ **Docker å®¹å™¨åŒ–**ï¼šå®Œå…¨å®¹å™¨åŒ–çš„å¼€å‘ç¯å¢ƒï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
- ğŸš€ **PHP 8.4**ï¼šåŸºäº serversideup/php:8.4-fpm-nginx é•œåƒ
- ğŸ”§ **åŒæ¨¡å¼æ”¯æŒ**ï¼šæ”¯æŒ Nginx ç›´æ¥æ¨¡å¼å’Œ Caddy åå‘ä»£ç†æ¨¡å¼
- ğŸ“Š **æ€§èƒ½ä¼˜åŒ–**ï¼šé¢„é…ç½® OPcacheã€PHP-FPM ä¼˜åŒ–è®¾ç½®
- ğŸ› ï¸ **äº¤äº’å¼ç®¡ç†**ï¼šæä¾›å‹å¥½çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·
- ğŸ“ **å®Œæ•´æ—¥å¿—**ï¼šé›†æˆæ—¥å¿—ç®¡ç†å’Œå®æ—¶ç›‘æ§
- ğŸ”’ **å®‰å…¨é…ç½®**ï¼šç”Ÿäº§çº§å®‰å…¨é…ç½®å’Œæƒé™ç®¡ç†

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### éƒ¨ç½²æ¨¡å¼

#### æ¨¡å¼ä¸€ï¼šNginx ç›´æ¥æ¨¡å¼ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰
```
æµè§ˆå™¨ â†’ Nginx (å®¹å™¨å†…) â†’ PHP-FPM â†’ Laravel
```
- ç«¯å£ï¼š80
- é…ç½®æ–‡ä»¶ï¼š`docker/docker-compose.yaml`
- ç‰¹ç‚¹ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ

#### æ¨¡å¼äºŒï¼šCaddy åå‘ä»£ç†æ¨¡å¼ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰
```
æµè§ˆå™¨ â†’ Caddy â†’ PHP-FPM â†’ Laravel
```
- ç«¯å£ï¼š80/443
- é…ç½®æ–‡ä»¶ï¼š`docker/docker-compose-caddy.yaml`
- ç‰¹ç‚¹ï¼šè‡ªåŠ¨ HTTPSï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

### ç›®å½•ç»“æ„

```
â”œâ”€â”€ docker/                 # Docker é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ docker-compose.yaml        # Nginx æ¨¡å¼é…ç½®
â”‚   â”œâ”€â”€ docker-compose-caddy.yaml  # Caddy æ¨¡å¼é…ç½®
â”‚   â”œâ”€â”€ start.sh           # äº¤äº’å¼ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ php-fpm-nginx/     # PHP-FPM + Nginx é•œåƒ
â”‚   â”œâ”€â”€ caddy/             # Caddy é…ç½®
â”‚   â””â”€â”€ appdata/           # æŒä¹…åŒ–æ•°æ®
â””â”€â”€ www/                   # Laravel åº”ç”¨ä»£ç 
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+
- Git

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd caddy_laravel
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
# æ£€æŸ¥å¹¶ä¿®æ”¹ docker/.env æ–‡ä»¶
cp docker/.env.example docker/.env  # å¦‚æœéœ€è¦
```

3. **å¯åŠ¨æœåŠ¡**
```bash
# ä½¿ç”¨äº¤äº’å¼ç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰
./docker/start.sh

# æˆ–ç›´æ¥ä½¿ç”¨ Docker Compose
cd docker

# Nginx æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
docker-compose up -d

# Caddy æ¨¡å¼
docker-compose -f docker-compose-caddy.yaml up -d
```

4. **è®¿é—®åº”ç”¨**
- Nginx æ¨¡å¼ï¼šhttp://localhost
- Caddy æ¨¡å¼ï¼šhttp://localhost æˆ– https://laravel.test

## ğŸ› ï¸ ç®¡ç†å·¥å…·

### äº¤äº’å¼ç®¡ç†è„šæœ¬

è¿è¡Œ `./docker/start.sh` å¯åŠ¨äº¤äº’å¼ç®¡ç†ç•Œé¢ï¼š

```
=== Docker Compose ç®¡ç†å·¥å…· ===
è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œï¼š
1. å¯åŠ¨æœåŠ¡ (åå°è¿è¡Œ)
2. å…³é—­æœåŠ¡
3. è¿›å…¥ PHP-FPM å®¹å™¨
4. è¿›å…¥ Caddy å®¹å™¨
5. å®‰è£… Composer ä¾èµ–
6. Laravel ç¼“å­˜ä¼˜åŒ–
7. Laravel æ¸…ç†å…¨éƒ¨ç¼“å­˜
8. æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿— (æœ€è¿‘50è¡Œ)
9. æŸ¥çœ‹ PHP-FPM æ—¥å¿— (æœ€è¿‘100è¡Œ)
a. æŸ¥çœ‹ Caddy æ—¥å¿— (æœ€è¿‘100è¡Œ)
b. å®æ—¶è·Ÿè¸ªæ‰€æœ‰æœåŠ¡æ—¥å¿—
c. é‡æ–°æ„å»ºå¹¶é‡å¯æœåŠ¡
d. è®¾ç½® www ç›®å½•æƒé™ (www-data)
e. æŸ¥çœ‹ Docker ç½‘ç»œä¿¡æ¯ (Gateway)
0. é€€å‡º
```

### å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 1

# è¿›å…¥ PHP å®¹å™¨
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 3

# å®‰è£…ä¾èµ–
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 5

# æŸ¥çœ‹æ—¥å¿—
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 8

# è®¾ç½®æƒé™
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ d
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `docker/.env` æ–‡ä»¶ï¼š

```bash
# ç«¯å£é…ç½®
NGINX_PORT=80
CADDY_HTTP_PORT=80
CADDY_HTTPS_PORT=443

# è·¯å¾„é…ç½®
APP_CODE_PATH_HOST=../www
APP_CODE_PATH_CONTAINER=/var/www/html

# PHP é…ç½®
PHP_MEMORY_LIMIT=256M
PHP_MAX_EXECUTION_TIME=120
PHP_UPLOAD_MAX_FILE_SIZE=1000M

# Laravel é…ç½®
APP_ENV=production
APP_DEBUG=false
```

### PHP æ€§èƒ½ä¼˜åŒ–

é¡¹ç›®é¢„é…ç½®äº†ä»¥ä¸‹ä¼˜åŒ–è®¾ç½®ï¼š

- **OPcache**ï¼šå¯ç”¨ä»£ç ç¼“å­˜ï¼Œæå‡æ€§èƒ½
- **PHP-FPM**ï¼šåŠ¨æ€è¿›ç¨‹ç®¡ç†ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨
- **ä¸Šä¼ é™åˆ¶**ï¼šæ”¯æŒå¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆæœ€å¤§ 1GBï¼‰
- **æ‰§è¡Œæ—¶é—´**ï¼šé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

### ç½‘ç»œé…ç½®

- **Nginx æ¨¡å¼**ï¼šå®¹å™¨ç›´æ¥æš´éœ²ç«¯å£ 80
- **Caddy æ¨¡å¼**ï¼šæ”¯æŒ HTTP/HTTPSï¼Œè‡ªåŠ¨è¯ä¹¦ç®¡ç†
- **å†…éƒ¨é€šä¿¡**ï¼šå®¹å™¨é—´é€šè¿‡ Docker ç½‘ç»œé€šä¿¡

#### è·å–å®¹å™¨ IP åœ°å€

```bash
# æŸ¥çœ‹ Docker ç½‘ç»œä¿¡æ¯ï¼ˆåŒ…å« Gatewayï¼‰
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ e

# è·å–ç‰¹å®šå®¹å™¨çš„ IP åœ°å€
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' <å®¹å™¨å>

# ä»ä¸»æœºè®¿é—®å®¹å™¨
ping <å®¹å™¨IP>
curl http://<å®¹å™¨IP>:8080
```

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

1. **å¯åŠ¨ç¯å¢ƒ**
```bash
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 1
```

2. **å®‰è£…ä¾èµ–**
```bash
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 5
```

3. **å¼€å‘è°ƒè¯•**
```bash
# è¿›å…¥å®¹å™¨
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 3

# åœ¨å®¹å™¨å†…æ‰§è¡Œ Laravel å‘½ä»¤
php artisan migrate
php artisan serve
```

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 8 æˆ– b
```

### ç¼“å­˜ç®¡ç†

```bash
# ä¼˜åŒ–ç¼“å­˜ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 6

# æ¸…ç†ç¼“å­˜ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 7
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :80
# ä¿®æ”¹ docker/.env ä¸­çš„ç«¯å£é…ç½®
```

2. **æƒé™é—®é¢˜**
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ d
```

3. **å®¹å™¨æ— æ³•å¯åŠ¨**
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 8
# é‡æ–°æ„å»ºå®¹å™¨
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ c
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 8

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ b

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ 9 (PHP-FPM)
./docker/start.sh  # é€‰æ‹©é€‰é¡¹ a (Caddy)
```

### æ€§èƒ½ä¼˜åŒ–

1. **å¯ç”¨ OPcache**ï¼ˆå·²é»˜è®¤å¯ç”¨ï¼‰
2. **è°ƒæ•´ PHP-FPM è¿›ç¨‹æ•°**ï¼šç¼–è¾‘ `docker/.env`
3. **ä¼˜åŒ– Laravel ç¼“å­˜**ï¼šä½¿ç”¨é€‰é¡¹ 6
4. **ç›‘æ§èµ„æºä½¿ç”¨**ï¼šä½¿ç”¨ `docker stats`

## ğŸ“š æ›´å¤šä¿¡æ¯

- [Laravel å®˜æ–¹æ–‡æ¡£](https://laravel.com/docs)
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Caddy å®˜æ–¹æ–‡æ¡£](https://caddyserver.com/docs/)
- [ServerSideUp PHP é•œåƒ](https://serversideup.net/open-source/docker-php/)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## æ‰“èµ

![alt text](image.png)